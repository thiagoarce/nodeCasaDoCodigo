"use strict";

var complain;
var classHelper = require("../../helpers/class-value");
var styleHelper = require("../../helpers/style-value");

/**
 * Helper for processing dynamic attributes
 */
module.exports = function (attributes) {
    if (typeof attributes === "string") {
        return parseAttrs(attributes);
        // eslint-disable-next-line no-constant-condition
    }

    if (attributes && (attributes.style || attributes.class)) {
        var newAttributes = {};
        Object.keys(attributes).forEach(function (name) {
            if (name === "class") {
                newAttributes[name] = classHelper(attributes[name]);
            } else if (name === "style") {
                newAttributes[name] = styleHelper(attributes[name]);
            } else {
                newAttributes[name] = attributes[name];
            }
        });
        return newAttributes;
    }
    return attributes;
};

var parseContainer;
function parseAttrs(str) {
    if (str === "") {
        return {};
    }

    parseContainer = parseContainer || document.createElement("div");
    parseContainer.innerHTML = "<a " + str + ">";
    var attrs = parseContainer.firstChild.attributes;
    var result = {};
    var attr;

    for (var len = attrs.length, i = 0; i < len; i++) {
        attr = attrs[i];
        result[attr.name] = attr.value;
    }

    return result;
}